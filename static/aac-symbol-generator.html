<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AAC Symbol Generator - Descriptive Words</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .symbol-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            min-height: 100px; /* Ensure container has height */
        }
        .symbol-card {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            transition: all 0.2s;
            position: relative;
            background-color: #ff9999 !important; /* Pink background for card debugging */
            min-height: 200px; /* Ensure card has height */
            border: 3px solid #ff0000 !important; /* Red border for debugging */
        }
        .symbol-card .relative {
            background-color: #ffeb3b !important; /* Bright yellow background for debugging */
            min-height: 160px; /* Ensure image container has height */
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #0000ff !important; /* Blue border for image wrapper */
        }
        .symbol-card img {
            display: block !important; /* Force image visibility */
            max-width: 100%;
            height: 160px; /* Fixed height */
            object-fit: contain;
            background-color: #f9fafb; /* Light background for contrast */
            position: relative !important; /* Ensure proper positioning */
            z-index: 10 !important; /* Bring to front */
            opacity: 1 !important; /* Force full opacity */
            visibility: visible !important; /* Force visibility */
            border: 1px solid #ddd; /* Add border to see image boundaries */
        }
        .symbol-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .symbol-card.selected {
            border-color: #10b981;
            background-color: #ecfdf5;
        }
        .word-tag {
            display: inline-block;
            background: #dbeafe;
            color: #1e40af;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            margin: 2px;
        }
        .step-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 2rem;
        }
        .step {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e5e7eb;
            color: #6b7280;
            font-weight: 600;
            margin: 0 1rem;
            position: relative;
        }
        .step.active {
            background: #3b82f6;
            color: white;
        }
        .step.completed {
            background: #10b981;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-center mb-8 text-gray-800">
            <i class="fas fa-palette mr-3"></i>
            AAC Symbol Generator
        </h1>
        <p class="text-center text-gray-600 mb-8">Generate missing descriptive word symbols for your AAC application</p>

        <!-- Step Indicator -->
        <div class="step-indicator">
            <div id="step-1" class="step active">1</div>
            <div class="w-16 h-1 bg-gray-300"></div>
            <div id="step-2" class="step">2</div>
            <div class="w-16 h-1 bg-gray-300"></div>
            <div id="step-3" class="step">3</div>
            <div class="w-16 h-1 bg-gray-300"></div>
            <div id="step-4" class="step">4</div>
        </div>

        <!-- Step 1: Select Words to Generate -->
        <div id="step-1-panel" class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Step 1: Select Missing Descriptive Words</h2>
            <p class="text-gray-600 mb-4">Choose which descriptive words you want to generate AAC symbols for:</p>
            
            <!-- Pre-defined word categories -->
            <div class="space-y-4">
                <div>
                    <h3 class="font-semibold text-gray-700 mb-2">Positive Descriptors</h3>
                    <div class="flex flex-wrap gap-2">
                        <label class="word-tag cursor-pointer hover:bg-blue-100">
                            <input type="checkbox" class="mr-1" value="fantastic" checked> fantastic
                        </label>
                        <label class="word-tag cursor-pointer hover:bg-blue-100">
                            <input type="checkbox" class="mr-1" value="awesome" checked> awesome
                        </label>
                        <label class="word-tag cursor-pointer hover:bg-blue-100">
                            <input type="checkbox" class="mr-1" value="amazing" checked> amazing
                        </label>
                        <label class="word-tag cursor-pointer hover:bg-blue-100">
                            <input type="checkbox" class="mr-1" value="incredible" checked> incredible
                        </label>
                        <label class="word-tag cursor-pointer hover:bg-blue-100">
                            <input type="checkbox" class="mr-1" value="wonderful" checked> wonderful
                        </label>
                        <label class="word-tag cursor-pointer hover:bg-blue-100">
                            <input type="checkbox" class="mr-1" value="brilliant" checked> brilliant
                        </label>
                        <label class="word-tag cursor-pointer hover:bg-blue-100">
                            <input type="checkbox" class="mr-1" value="excellent" checked> excellent
                        </label>
                        <label class="word-tag cursor-pointer hover:bg-blue-100">
                            <input type="checkbox" class="mr-1" value="outstanding" checked> outstanding
                        </label>
                    </div>
                </div>

                <div>
                    <h3 class="font-semibold text-gray-700 mb-2">Enhanced Emotions</h3>
                    <div class="flex flex-wrap gap-2">
                        <label class="word-tag cursor-pointer hover:bg-blue-100">
                            <input type="checkbox" class="mr-1" value="ecstatic"> ecstatic
                        </label>
                        <label class="word-tag cursor-pointer hover:bg-blue-100">
                            <input type="checkbox" class="mr-1" value="delighted"> delighted
                        </label>
                        <label class="word-tag cursor-pointer hover:bg-blue-100">
                            <input type="checkbox" class="mr-1" value="thrilled"> thrilled
                        </label>
                        <label class="word-tag cursor-pointer hover:bg-blue-100">
                            <input type="checkbox" class="mr-1" value="overjoyed"> overjoyed
                        </label>
                        <label class="word-tag cursor-pointer hover:bg-blue-100">
                            <input type="checkbox" class="mr-1" value="content"> content
                        </label>
                        <label class="word-tag cursor-pointer hover:bg-blue-100">
                            <input type="checkbox" class="mr-1" value="serene"> serene
                        </label>
                    </div>
                </div>

                <div>
                    <h3 class="font-semibold text-gray-700 mb-2">Activity Descriptors</h3>
                    <div class="flex flex-wrap gap-2">
                        <label class="word-tag cursor-pointer hover:bg-blue-100">
                            <input type="checkbox" class="mr-1" value="energetic"> energetic
                        </label>
                        <label class="word-tag cursor-pointer hover:bg-blue-100">
                            <input type="checkbox" class="mr-1" value="dynamic"> dynamic
                        </label>
                        <label class="word-tag cursor-pointer hover:bg-blue-100">
                            <input type="checkbox" class="mr-1" value="vibrant"> vibrant
                        </label>
                        <label class="word-tag cursor-pointer hover:bg-blue-100">
                            <input type="checkbox" class="mr-1" value="creative"> creative
                        </label>
                        <label class="word-tag cursor-pointer hover:bg-blue-100">
                            <input type="checkbox" class="mr-1" value="artistic"> artistic
                        </label>
                        <label class="word-tag cursor-pointer hover:bg-blue-100">
                            <input type="checkbox" class="mr-1" value="confident"> confident
                        </label>
                    </div>
                </div>
            </div>

            <!-- Custom words input -->
            <div class="mt-6">
                <label for="custom-words" class="block text-sm font-medium text-gray-700 mb-2">
                    Add Custom Words (comma-separated):
                </label>
                <textarea 
                    id="custom-words" 
                    rows="3" 
                    placeholder="e.g., spectacular, phenomenal, magnificent..."
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                ></textarea>
            </div>

            <div class="flex justify-between items-center mt-6">
                <div class="text-sm text-gray-500">
                    <span id="selected-count">8</span> words selected
                </div>
                <button 
                    onclick="proceedToGeneration()"
                    class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-md transition duration-200"
                >
                    Generate Symbols <i class="fas fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>

        <!-- Step 2: Configure Generation -->
        <div id="step-2-panel" class="bg-white rounded-lg shadow-md p-6 mb-6 hidden">
            <h2 class="text-xl font-semibold mb-4">Step 2: Configure Symbol Generation</h2>
            
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Symbol Style:
                    </label>
                    <select id="symbol-style" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="picom-style">PiCom Style (match existing symbols)</option>
                        <option value="minimalist">Minimalist</option>
                        <option value="friendly">Friendly & Colorful</option>
                        <option value="high-contrast">High Contrast (accessibility)</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Variations per word:
                    </label>
                    <select id="variations-count" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="1">1 (fastest)</option>
                        <option value="2" selected>2 (recommended)</option>
                        <option value="3">3 (more options)</option>
                    </select>
                </div>
            </div>

            <div class="mt-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    Additional Style Notes:
                </label>
                <textarea 
                    id="style-notes" 
                    rows="3" 
                    placeholder="e.g., Use bright colors for positive words, simple geometric shapes, avoid text..."
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                >Simple, clear symbols suitable for AAC communication. High contrast, minimal details, universally recognizable.</textarea>
            </div>

            <div class="flex justify-between items-center mt-6">
                <button 
                    onclick="goToStep(1)"
                    class="bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 px-4 rounded-md transition duration-200"
                >
                    <i class="fas fa-arrow-left mr-2"></i> Back
                </button>
                <button 
                    id="generate-symbols-btn"
                    onclick="generateSymbols()"
                    class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-6 rounded-md transition duration-200"
                >
                    <i class="fas fa-magic mr-2"></i> Generate Symbols
                </button>
            </div>
        </div>

        <!-- Step 3: Review Generated Symbols -->
        <div id="step-3-panel" class="bg-white rounded-lg shadow-md p-6 mb-6 hidden">
            <h2 class="text-xl font-semibold mb-4">Step 3: Review Generated Symbols</h2>
            <p class="text-gray-600 mb-4">Review the generated symbols and select the best ones for your AAC database:</p>
            
            <div id="generated-symbols-container" class="symbol-grid mb-6">
                <!-- Generated symbols will be loaded here -->
            </div>

            <div class="flex justify-between items-center">
                <button 
                    onclick="goToStep(2)"
                    class="bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 px-4 rounded-md transition duration-200"
                >
                    <i class="fas fa-arrow-left mr-2"></i> Back
                </button>
                <button 
                    onclick="proceedToImport()"
                    class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-md transition duration-200"
                >
                    Import to AAC Database <i class="fas fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>

        <!-- Step 4: Import to AAC Database -->
        <div id="step-4-panel" class="bg-white rounded-lg shadow-md p-6 mb-6 hidden">
            <h2 class="text-xl font-semibold mb-4">Step 4: Import to AAC Database</h2>
            <p class="text-gray-600 mb-4">Selected symbols are being processed and added to your AAC symbol database:</p>
            
            <div id="import-progress" class="mb-6">
                <div class="bg-gray-200 rounded-full h-4">
                    <div id="import-progress-bar" class="bg-blue-600 h-4 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
                <p id="import-status" class="text-sm text-gray-600 mt-2">Ready to import...</p>
            </div>

            <div id="import-results" class="hidden">
                <h3 class="font-semibold text-green-600 mb-2">
                    <i class="fas fa-check-circle mr-2"></i>
                    Import Complete!
                </h3>
                <p class="text-gray-600 mb-4">Successfully added <span id="imported-count">0</span> new symbols to your AAC database.</p>
                
                <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-4">
                    <h4 class="font-semibold text-green-800 mb-2">What's Next?</h4>
                    <ul class="text-green-700 space-y-1">
                        <li>• Test your LLM-generated buttons - they should now find unique symbols</li>
                        <li>• Try "Generic Greetings" to see "fantastic", "awesome" symbols in action</li>
                        <li>• Generate more symbols anytime for missing words</li>
                    </ul>
                </div>
                
                <button 
                    onclick="startOver()"
                    class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-md transition duration-200"
                >
                    <i class="fas fa-plus mr-2"></i> Generate More Symbols
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase Auth Configuration -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js'
        import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js'
        
        // Firebase configuration will be loaded dynamically
        let firebaseConfig = {};
        let auth = null;
        
        // Load Firebase config and initialize
        async function initializeFirebase() {
            try {
                const response = await fetch('/api/frontend-config');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                const config = await response.json();
                
                // Use the firebase_config from the response
                firebaseConfig = config.firebase_config || config;
                
                // Validate that we have a valid API key
                if (!firebaseConfig.apiKey || firebaseConfig.apiKey === '') {
                    throw new Error('Invalid or missing Firebase API key');
                }
                
                console.log('Firebase config loaded:', {
                    apiKey: firebaseConfig.apiKey ? '[PRESENT]' : '[MISSING]',
                    projectId: firebaseConfig.projectId,
                    environment: config.environment
                });
                
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                
                console.log('Firebase initialized successfully');
                
                // Set up auth state monitoring
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        console.log('User signed in:', user.email);
                        document.body.classList.remove('loading');
                    } else {
                        console.log('User not signed in, redirecting to auth...');
                        window.location.href = '/static/auth.html';
                    }
                });
                
            } catch (error) {
                console.error('Firebase initialization failed:', error);
                alert('Firebase initialization failed: ' + error.message);
            }
        }

        // Global function to get auth token
        window.getAuthToken = async () => {
            if (!auth || !auth.currentUser) {
                throw new Error('User not authenticated');
            }
            return await auth.currentUser.getIdToken();
        };
        
        // Initialize Firebase when page loads
        initializeFirebase();
    </script>

    <script src="/static/aac-symbol-generator.js?v=debug1"></script>
</body>
</html>